<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <!-- https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP -->
  <!-- https://www.youtube.com/watch?v=r9ZTWQtzk2Y -->
  <!-- <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline' https://developers.google.com/blockly/xml">
  <meta http-equiv="X-Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline'; script-src-elem 'self' 'unsafe-inline' https://developers.google.com/blockly/xml"> -->
  <title>Virtual Robot Simulator Controller</title>
  <style>
    body {
      background-color: #242424;
    }

    h1 {
      margin-top: 0%;
      padding-left: 20px;
      font-weight: normal;
      font-size: 40px;
      font-family: Jura;
      color: white;
    }

    h2 {
      font-size: 20px;
      padding-left: 35px;
      font-family: Jura;
      color: white;
    }

    .center {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    }

    .center-horizontal {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @font-face {
      font-family: 'Jura';
      src: url('./blocks/fonts/Jura-Light.ttf');
    }

    .blocklyText,
    .blocklyHtmlInput,
    .blocklyTreeLabel {
      font-family: 'Jura', sans-serif !important;
    }

    .blocklyTreeLabel {
      font-size: 20px !important;
    }

    .blocklyTreeRow {
      height: 28px !important;
      margin-top: 5px !important;
    }

    input:focus,
    textarea:focus,
    div:focus,
    select:focus {
      outline: none;
    }


    .button1 {
      background-color: white;
      border-radius: 6px;
      color: #242424;
      text-align: center;
      font-family: Jura;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      font-size: 15px;
      transition-duration: 0.4s;
      cursor: pointer;
    }

    .button1 {
      background-color: #242424;
      color: white;
      border: 2px solid white;
    }

    .button1:hover {
      background-color: white;
      color: #242424;
    }

    .button1:focus {
      outline: none;
      box-shadow: none;
    }

    .chevron::before {
      border-style: solid;
      border-width: 0.25em 0.25em 0 0;
      content: '';
      display: inline-block;
      height: 0.45em;
      left: 0.15em;
      position: relative;
      top: 0.15em;
      transform: rotate(-45deg);
      vertical-align: top;
      width: 0.45em;
      color: white;
    }

    .chevron.left:before {
      left: 0.25em;
      transform: rotate(-135deg);
    }

    input[type=text] {
      width: 225px;
      box-sizing: border-box;
      border: 2px solid white;
      border-radius: 6px;
      font-family: Jura;
      text-align: center;
      font-size: 15px;
      background-color: #242424;
      color: white;
    }

    .dropdown-select {
      font-family: Jura;
      font-size: 15px;
      position: relative;
      font-weight: bold;
      border: 0;
    }

    .dropdown-select>option {
      margin: 3px;
      padding: 6px 8px;
      cursor: pointer;
    }

    .dropdown-dark {
      border-radius: 12px;
      background-color: #242424;
    }

    .dropdown-dark:before {
      border-bottom-color: white;
    }

    .dropdown-dark:after {
      border-top-color: white;
    }

    .dropdown-dark .dropdown-select {
      color: white;
      text-shadow: 0 1px black;
      background: #242424;
    }

    .dropdown-dark .dropdown-select:focus {
      color: white;
    }

    .dropdown-dark .dropdown-select>option {
      background: #242424;
    }

    ::-webkit-scrollbar {
      width: 0px;
      background: transparent;
      /* make scrollbar transparent */
    }
  </style>
</head>

<body>
  <script src="./blocks/blockly/blockly_compressed.js"></script>
  <script src="./blocks/blockly/blocks_compressed.js"></script>
  <script src="./blocks/blockly/msg/js/en.js"></script>
  <script src="./blocks/interpreter/acorn_interpreter.js"></script>
  <script src="./blocks/blockly/javascript_compressed.js"></script>

  <script src="./codemirror/lib/codemirror.js"></script>
  <link rel="stylesheet" href="./codemirror/lib/codemirror.css">
  <link rel="stylesheet" href="./codemirror/theme/darcula.css">

  <script src="./codemirror/addon/edit/closebrackets.js"></script>
  <script src="./codemirror/addon/comment/comment.js"></script>
  <script src="./codemirror/addon/fold/foldcode.js"></script>
  <script src="./codemirror/addon/fold/foldgutter.js"></script>
  <script src="./codemirror/addon/fold/brace-fold.js"></script>
  <script src="./codemirror/addon/fold/comment-fold.js"></script>
  <script src="./codemirror/addon/fold/indent-fold.js"></script>

  <link rel="stylesheet" href="./codemirror/addon/hint/show-hint.css">
  <script src="./codemirror/addon/hint/show-hint.js"></script>
  <script src="./codemirror/mode/clike/clike.js"></script>
  <script src="./codemirror/lib/util/formatting.js"></script>

  <link rel="stylesheet" href="toolbox_style.css">

  <link rel="stylesheet" href="./font-awesome/css/font-awesome.min.css">

  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">

  <div style="display: flex; display: inline;">
    <a href="homepage.html" id="backButton"><span class="chevron left"></span></a>
    <div style="width: 50px; display: inline-block;"></div>
    <button class="button1" onclick="switchToBlocks()">Blocks</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="switchToOnBotJava()">OnBotJava</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="startProgram()">Start Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="stopProgram()">Stop Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="resetField()">Reset Field</button>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="newProgram()">New Program</button>
    <div style="width: 10px; display: inline-block;"></div>


    <div class="dropdown dropdown-dark" style="display: inline-block; background-color: #FFFFFF;">
      <select id="programSelect" class="dropdown-select" onchange="loadProgram()">
        <option value="">Load Program</option>
      </select>
    </div>
    <div style="width: 10px; display: inline-block;"></div>
    <button class="button1" onclick="prepareUiToSaveProgram()">Save Program</button>
    <div style="width: 10px; display: inline-block;"></div>
    <div class="center-horizontal" id="saveProgramDiv" style="display: none;">
      <form onSubmit="return false;" style="display: inline-block;">
        <input type="text" id="saveProgramName">
      </form>
      <div style="width: 5px; display: inline-block;"></div>
      <button class="button1" onclick="saveProgram()">OK</button>
    </div>
  </div>


  <div class="container" style="display: flex; height: 100%; padding-top: 5px;">
    <div id="blocklyDiv" style="width: 50%; border:1px solid white;"></div>
    <div id="onBotJavaDiv" style="width: 50%;border:1px solid white;" hidden>
      <h1 id="loadingOBJText">HI</h1>
    </div>
    <div style="width: 50%; background-color: #242424; padding-left: 10px;">
      <div id="controlPanel" style="height: 50%; overflow:scroll; background-color: #242424; border:1px solid white;">
        <h1>Telemetry</h1>
        <div style="width:100%; overflow:hidden; background-color: #323232;">
          <h2 id="telemetryText"></h2>
        </div>
      </div>

      <div id="fieldView" style="height: 50%; margin-top: 10px; background-color: #000000; overflow: hidden;" disabled>
        <div id="unity-container" class="unity-desktop">
          <canvas id="unity-canvas"></canvas>
          <div id="unity-loading-bar">
            <div id="unity-logo"></div>
            <div id="unity-progress-bar-empty">
              <div id="unity-progress-bar-full"></div>
            </div>
          </div>
          <div id="unity-mobile-warning">
            WebGL builds are not supported on mobile devices.
          </div>
          <div id="unity-footer">
            <div id="unity-webgl-logo"></div>
            <div id="unity-fullscreen-button"></div>
            <div id="unity-build-title">Robot Simulator</div>
          </div>
        </div>
        <script>
          var buildUrl = "webgl/Build";
          var loaderUrl = buildUrl + "/Webgl.loader.js";
          var config = {
            dataUrl: buildUrl + "/Webgl.data",
            frameworkUrl: buildUrl + "/Webgl.framework.js",
            codeUrl: buildUrl + "/Webgl.wasm",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "VirtualFTC",
            productName: "Robot Simulator",
            productVersion: "0.1",
          };

          var container = document.querySelector("#unity-container");
          var canvas = document.querySelector("#unity-canvas");
          var loadingBar = document.querySelector("#unity-loading-bar");
          var progressBarFull = document.querySelector("#unity-progress-bar-full");
          var fullscreenButton = document.querySelector("#unity-fullscreen-button");
          var mobileWarning = document.querySelector("#unity-mobile-warning");

          // By default Unity keeps WebGL canvas render target size matched with
          // the DOM size of the canvas element (scaled by window.devicePixelRatio)
          // Set this to false if you want to decouple this synchronization from
          // happening inside the engine, and you would instead like to size up
          // the canvas DOM size and WebGL render target sizes yourself.
          // config.matchWebGLToCanvasSize = false;

          if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
            container.className = "unity-mobile";
            // Avoid draining fillrate performance on mobile devices,
            // and default/override low DPI mode on mobile browsers.
            config.devicePixelRatio = 1;
            mobileWarning.style.display = "block";
            setTimeout(() => {
              mobileWarning.style.display = "none";
            }, 5000);
          } else {
            canvas.style.width = "960px";
            canvas.style.height = "600px";
          }
          loadingBar.style.display = "block";

          var script = document.createElement("script");
          script.src = loaderUrl;
          script.onload = () => {
            createUnityInstance(canvas, config, (progress) => {
              progressBarFull.style.width = 100 * progress + "%";
            }).then((unityInstance) => {
              console.log("WROTE: " + unityInstance);
              UnityInstance = unityInstance;

              loadingBar.style.display = "none";
              fullscreenButton.onclick = () => {
                unityInstance.SetFullscreen(1);
              };
            }).catch((message) => {
              alert(message);
            });
          };
          document.body.appendChild(script);

          var frontLeftEncoders = 0;
          var frontRightEncoders = 0;
          var backLeftEncoders = 0;
          var backRightEncoders = 0;

          function setFrontLeftEncoders(encoders) {
            frontLeftEncoders = encoders;
          }
          function setFrontRightEncoders(encoders) {
            frontRightEncoders = encoders;
          }
          function setBackLeftEncoders(encoders) {
            backLeftEncoders = encoders;
          }
          function setBackRightEncoders(encoders) {
            backRightEncoders = encoders;
          }
        </script>
      </div>
    </div>
  </div>



  <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
    <category css-icon="customIcon fa fa-long-arrow-right" name="LinearOpMode" colour="30"
      toolboxitemid="linearOpModeCategory">
      <block type="pause"></block>
    </category>

    <category css-icon="customIcon fa fa-gamepad" name="Gamepad" colour="1" toolboxitemid="gamepadCategory">
      <block type="gamepadInputs"></block>
    </category>

    <category css-icon="customIcon fa fa-caret-right" name="Utilities" colour="250" toolboxitemid="utilitiesCategory">
      <category name="Telemetry">
        <block type="telemetryUpdate"></block>
        <block type="telemetryAddData">
          <value name="key">
            <shadow type="text"></shadow>
          </value>
          <value name="data">
            <shadow type="text"></shadow>
          </value>
        </block>
      </category>
    </category>

    <category css-icon="customIcon fa fa-caret-right" name="Actuators" colour="#f58a42" toolboxitemid="motorCategory">
      <category css-icon="customIcon fa fa-caret-right" name="DcMotor">
        <block type="getMotorData">
          <field name="motorOption">["TargetPosition","targetPosition"]</field>
        </block>

        <block type="setMotorDirection">
          <value name="motorOption2">
            <shadow type="directionInput"></shadow>
          </value>
        </block>

        <block type="getMotorDirection"></block>

        <block type="setMotorRunMode">
          <value name="runMode">
            <shadow type="runModeOptions"></shadow>
          </value>
        </block>

        <block type="setMotorInput">
          <value name="power">
            <shadow type="math_number"></shadow>
          </value>
        </block>

        <block type="setMotorZeroPowerBehavior">
          <value name="motorOption2">
            <shadow type="zeroPowerBehaviorOptions"></shadow>
          </value>
        </block>

        <block type="isMotorBusy"></block>
        <!--Creation of the subcategory for the dual DC Motor block-->
        <category name="Dual" toolboxitemid="motorCategory2">
          <block type="setMotorInputDual">
            <value name="power1">
              <shadow type="math_number"></shadow>
            </value>
            <value name="power2">
              <shadow type="math_number"></shadow>
            </value>
          </block>

          <block type="setMotorRunModeDual">
            <value name="input1">
              <shadow type="runModeOptions"></shadow>
            </value>
            <value name="input2">
              <shadow type="runModeOptions"></shadow>
            </value>
          </block>

          <block type="setMotorZeroPowerBehaviorDual">
            <value name="input1">
              <shadow type="zeroPowerBehaviorOptions"></shadow>
            </value>
            <value name="input2">
              <shadow type="zeroPowerBehaviorOptions"></shadow>
            </value>
          </block>
        </category>

        <category name="Extended">
          <block type="setMotorVelocity">
            <value name="input1">
              <shadow type="math_number"></shadow>
            </value>
            <value name="input2">
              <shadow type="setVelocityAngleUnitInput"></shadow>
            </value>
          </block>

          <block type="setMotorEnable"></block>
          <block type="setMotorDisable"></block>
        </category>
      </category>
    </category>

    <sep></sep>

    <category name="Logic" colour="210" toolboxitemid="logicCategory">
      <block type="controls_if"></block>
      <block type="controls_ifelse"></block>
      <block type="logic_compare"></block>
      <block type="logic_operation"></block>
      <block type="logic_negate"></block>
      <block type="logic_boolean"></block>
      <block type="logic_null"></block>
      <block type="logic_ternary"></block>
    </category>
    <category name="Loops" colour="110" toolboxitemid="loopsCategory">
      <block type="controls_repeat"></block>
      <block type="controls_whileUntil"></block>
      <block type="controls_for"></block>
      <block type="controls_forEach"></block>
      <block type="controls_flow_statements"></block>
    </category>
    <category name="Math" colour="230" toolboxitemid="mathCategory">
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="math_single"></block>
      <block type="math_trig"></block>
      <block type="math_atan2"></block>
      <block type="math_constant"></block>
      <block type="math_number_property"></block>
      <block type="math_round"></block>
      <block type="math_on_list"></block>
      <block type="math_modulo"></block>
      <block type="math_constrain"></block>
      <block type="math_random_int"></block>
      <block type="math_random_float"></block>
    </category>
    <category name="Text" colour="150" toolboxitemid="textCategory">
      <block type="text"></block>
      <block type="text_print"></block>
      <block type="text_join"></block>
      <block type="text_append"></block>
      <block type="text_length"></block>
      <block type="text_isEmpty"></block>
      <block type="text_indexOf"></block>
      <block type="text_charAt"></block>
      <block type="text_getSubstring"></block>
      <block type="text_changeCase"></block>
      <block type="text_trim"></block>
    </category>
    <category name="Lists" colour="255" toolboxitemid="listCategory">
      <block type="lists_create_empty"></block>
      <block type="lists_create_with"></block>
      <block type="lists_repeat"></block>
      <block type="lists_length"></block>
      <block type="lists_isEmpty"></block>
      <block type="lists_getIndex"></block>
      <block type="lists_setIndex"></block>
      <block type="lists_getSublist"></block>
      <block type="lists_split"></block>
      <block type="lists_sort"></block>
    </category>
    <category name="Variables" colour="#a3392c" custom="VARIABLE" toolboxitemid="variablesCategory"></category>
    <category name="Functions" colour="285" custom="PROCEDURE" toolboxitemid="functionsCategory"></category>
    <category name="Miscellaneous" colour="230" toolboxitemid="miscellaneousCategory">
      <block type="comment"></block>
    </category>
  </xml>


  <script>
    var isUsingBlocks = true;
    var delayTime = 0;
    var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
    // var motorEncoderBaseValues = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
    // var motorReverseValues = { "m1": 1.0, "m2": 1.0, "m3": 1.0, "m4": 1.0, "m5": 1.0, "m6": 1.0, "m7": 1.0, "m8": 1.0 };

    var UnityInstance = null;
    function check() {
      if (UnityInstance != null) {
        UnityInstance.SendMessage("Main Menu", "changeSinglePlayer");
      } else {
        setTimeout(check, 500);
      }
    }

    check();

    function writeMotorsToUnity() {
      var motor1 = motorPowers[Object.keys(motorPowers)[0]];
      var motor2 = motorPowers[Object.keys(motorPowers)[1]];
      var motor3 = motorPowers[Object.keys(motorPowers)[2]];
      var motor4 = motorPowers[Object.keys(motorPowers)[3]];
      var motor5 = motorPowers[Object.keys(motorPowers)[4]];
      var motor6 = motorPowers[Object.keys(motorPowers)[5]];
      var motor7 = motorPowers[Object.keys(motorPowers)[6]];
      var motor8 = motorPowers[Object.keys(motorPowers)[7]];
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setFrontLeftVel", motor1);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setFrontRightVel", motor2);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setBackLeftVel", motor3);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setBackRightVel", motor4);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setMotor5", motor5);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setMotor6", motor6);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setMotor7", motor7);
      UnityInstance.SendMessage("PhotonNetworkPlayer(Clone)", "setMotor8", motor8);
    }


    var shouldBeUpdatingLoadingText = true;
    var counterForLoadingText = 1;
    document.getElementById('controlPanel').style.height = screen.height / 2 - 30 + "px";
    document.getElementById('fieldView').style.height = screen.height / 2 - 30 + "px";
    document.getElementById('onBotJavaDiv').style.height = screen.height - 48 + "px";

    function switchToBlocks() {
      document.getElementById('blocklyDiv').hidden = false;
      document.getElementById('onBotJavaDiv').hidden = true;
      isUsingBlocks = true;
    }

    function switchToOnBotJava() {
      document.getElementById('blocklyDiv').hidden = true;
      document.getElementById('onBotJavaDiv').hidden = false;
      isUsingBlocks = false;
      setUpOnBotJava();
    }
    var editor;
    function setUpOnBotJava() {
      editor = CodeMirror(function (elt) {
        document.getElementById('onBotJavaDiv').replaceChild(elt, document.getElementById('loadingOBJText'));
      }, {
        value: "public class MyOpMode extends LinearOpMode {\n@Override\npublic void runOpMode() {\n// NOTE: ONBOTJAVA IS STILL UNDER CONSTRUCTION\nwhile (opModeIsActive()) {\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\nfrontLeft.setPower(1.0);\n}\n}\n}\n",
        mode: "text/x-java",
        lineNumbers: true,
        theme: "darcula",
        scrollbarStyle: null,
        autocorrect: true,
        autoCloseBrackets: true,
      });
      autoFormatSelection();
    }

    function getSelectedRange() {
      return { from: editor.getCursor(true), to: editor.getCursor(false) };
    }

    function autoFormatSelection() {
      var cursor = editor.getCursor();
      CodeMirror.commands["selectAll"](editor);
      var range = getSelectedRange();
      editor.autoFormatRange(range.from, range.to);
      editor.setCursor(cursor);
    }

    var isSavingProgram = false;

    function prepareUiToSaveProgram() {
      isSavingProgram = !isSavingProgram;
      if (isSavingProgram) {
        document.getElementById("saveProgramDiv").style = "display: inline;";
      } else {
        document.getElementById("saveProgramDiv").style = "display: none;";
      }
    }

    function prepareUiToLoadProgram() {
      var keys = Object.keys(localStorage),
        i = keys.length;

      document.getElementById("programSelect").options.length = 1;

      while (i--) {
        console.log(keys[i]);
        if (keys[i].includes("Program Name: ")) {
          var option = document.createElement("option");
          option.value = keys[i].replace("Program Name: ", "");
          option.text = keys[i].replace("Program Name: ", "");
          document.getElementById("programSelect").appendChild(option);
        }
      }
    }

    prepareUiToLoadProgram();

    function saveProgram() {
      var programName = document.getElementById('saveProgramName').value;
      var xml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
      localStorage.setItem("Program Name: " + programName, Blockly.Xml.domToText(xml));
      prepareUiToLoadProgram();
      document.getElementById('saveProgramName').value = "";
      document.getElementById("saveProgramDiv").style = "display: none;";
    }

    function newProgram() {
      Blockly.mainWorkspace.clear();
      Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom('<xml><block type="onOpmodeStart" deletable="false" movable="true"></block></xml>'), workspace);
    }

    function loadProgram() {
      Blockly.mainWorkspace.clear();
      var nameOfProject = "Program Name: " + document.getElementById("programSelect").value;
      if (nameOfProject == "Program Name: Load Program") {
        newProgram();
      } else if (typeof (Storage) !== "undefined") {
        var xml = Blockly.Xml.textToDom(localStorage.getItem(nameOfProject));
        Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xml);
      }
    }

    function resetField() {
      UnityInstance.SendMessage("FieldManager", "resetField");
    }

    function initApi(interpreter, globalObject) {
      // Add an API function for the alert() block.
      var wrapper = function (text) {
        UnityInstance.SendMessage("FieldManager", "buttonStartGame");
        document.getElementById("telemetryText").innerText = "Program Started \n";
        return console.log(arguments.length ? text : '');
      };
      interpreter.setProperty(globalObject, 'alert', interpreter.createNativeFunction(wrapper));

      wrapper = function (motorName, power) {
        if (motorName == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motorName == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power };
        }
        return writeMotorsToUnity();
      };
      interpreter.setProperty(globalObject, 'setPower', interpreter.createNativeFunction(wrapper));

      wrapper = function (motorName) {
        console.log("asjdfasnlfajsfn");
        encoderValue = 0;
        if (motorName == "frontLeft") {
          encoderValue = frontLeftEncoders;// - motorEncoderBaseValues[Object.keys(motorEncoders)[0]];
        } else if (motorName == "frontRight") {
          encoderValue = frontRightEncoders;// - motorEncoderBaseValues[Object.keys(motorEncoders)[1]];
        } else if (motorName == "backLeft") {
          encoderValue = backLeftEncoders;// - motorEncoderBaseValues[Object.keys(motorEncoders)[2]];
        } else if (motorName == "backRight") {
          encoderValue = backRightEncoders;// - motorEncoderBaseValues[Object.keys(motorEncoders)[3]];
        }
        return encoderValue;
      };
      interpreter.setProperty(globalObject, 'getEncoders', interpreter.createNativeFunction(wrapper));

      wrapper = function (delayTime) {
        pauseTime = delayTime;
        return delayTime;
      };
      interpreter.setProperty(globalObject, 'delay', interpreter.createNativeFunction(wrapper));

      wrapper = function (motor1Name, power, motor2Name, power2) {
        if (motor1Name == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor1Name == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power };
        }

        if (motor2Name == "frontLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": power2, "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "frontRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": power2, "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "backLeft") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": power2, "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "backRight") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": power2, "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringCollection") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": power2, "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringLoader") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": power2, "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "ringLauncher") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": power2, "motor8": motorPowers[Object.keys(motorPowers)[7]] };
        } else if (motor2Name == "wobbleActuator") {
          // power = power * motorReverseValues[Object.keys(motorPowers)[0]];
          motorPowers = { "motor1": motorPowers[Object.keys(motorPowers)[0]], "motor2": motorPowers[Object.keys(motorPowers)[1]], "motor3": motorPowers[Object.keys(motorPowers)[2]], "motor4": motorPowers[Object.keys(motorPowers)[3]], "motor5": motorPowers[Object.keys(motorPowers)[4]], "motor6": motorPowers[Object.keys(motorPowers)[5]], "motor7": motorPowers[Object.keys(motorPowers)[6]], "motor8": power2 };
        }
        return writeMotorsToUnity();
      };
      interpreter.setProperty(globalObject, 'setDualPower', interpreter.createNativeFunction(wrapper));

      var wrapper = function (key, data) {
        return (document.getElementById("telemetryText").innerText = document.getElementById("telemetryText").innerText + key + ": " + data + "\n");
      };
      interpreter.setProperty(globalObject, 'addTelemetryData', interpreter.createNativeFunction(wrapper));
    }

    var myInterpreter = null;
    var runner;
    var pauseTime = 0;

    function resetInterpreter() {
      myInterpreter = null;
      pauseTime = 0;
      if (runner) {
        clearTimeout(runner);
        runner = null;
      }
    }

    function startProgram() {
      var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
      var code = Blockly.JavaScript.workspaceToCode(Blockly.mainWorkspace);
      console.log(code);
      myInterpreter = new Interpreter(code, initApi);
      nextStep();
      return;
    }

    function nextStep() {
      if (myInterpreter.step()) {
        for (var i = 0; i < 1000; i++) {
          localStorage.setItem("Hello", "hi");
          localStorage.getItem("Hello");
        }
        nextStep();
      } else {
        resetInterpreter();
      }
    }

    function stopProgram() {
      var motorPowers = { "m1": 0.0, "m2": 0.0, "m3": 0.0, "m4": 0.0, "m5": 0.0, "m6": 0.0, "m7": 0.0, "m8": 0.0 };
      writeMotorsToUnity();
      UnityInstance.SendMessage("FieldManager", "buttonStopGame");
    }

    Blockly.JavaScript['onOpmodeStart'] = function (block) {
      return 'alert("Start");\n'
    };

    Blockly.JavaScript['setMotorInput'] = function (block) {
      return 'setPower(\"' + block.getFieldValue('motorName') + '\", ' + parseFloat(Blockly.JavaScript.valueToCode(block, 'power', Blockly.JavaScript.ORDER_NONE)) + ');\n'
    };

    Blockly.JavaScript['getMotorData'] = function (block) {
      return ['getEncoders(\"' + block.getFieldValue('motorName') + '\")', Blockly.JavaScript.ORDER_FUNCTION_CALL]
    };

    Blockly.JavaScript['setMotorInputDual'] = function (block) {
      return 'setDualPower(\"' + block.getFieldValue('motorName1') + '\", ' + parseFloat(Blockly.JavaScript.valueToCode(block, 'power1', Blockly.JavaScript.ORDER_NONE)) + ', \"' + block.getFieldValue('motorName2') + '\", ' + parseFloat(Blockly.JavaScript.valueToCode(block, 'power2', Blockly.JavaScript.ORDER_NONE)) + ');\n'
    };

    Blockly.JavaScript['telemetryAddData'] = function (block) {
      return 'addTelemetryData(' + Blockly.JavaScript.valueToCode(block, 'key', Blockly.JavaScript.ORDER_NONE) + ', ' + Blockly.JavaScript.valueToCode(block, 'data', Blockly.JavaScript.ORDER_NONE) + ');\n'
    };

    Blockly.JavaScript['pause'] = function (block) {
      delayTime = block.getFieldValue('delayTime');
      return 'delay(' + delayTime + ');\n';
    };

    Blockly.JavaScript['comment'] = function (block) {
      var text = block.getFieldValue('commentText');
      return '//' + text + '\n';
    };

    Blockly.JavaScript.addReservedWords('exit');

    var workspace = Blockly.inject('blocklyDiv',
      {
        media: './blocks/media/',
        toolbox: document.getElementById('toolbox'),
        move: {
          scrollbars: true,
          drag: false,
          wheel: false
        },
        theme: {
          'base': Blockly.Themes.Classic,
          'fontStyle': {
            "weight": "bold",
            "size": 12
          },
          'componentStyles': {
            'workspaceBackgroundColour': '#242424',
            "toolboxBackgroundColour": "#333",
            "scrollbarColour": "#424242",
            "toolboxForegroundColour": "#FFFFFF",
            "flyoutBackgroundColour": "#424242",
            "markerColour": "#FFFFFF"
          }
        },
        grid: {
          spacing: 50,
          length: 5,
          colour: '#505050',
        },
        trashcan: true,
        zoom: {
          controls: true,
          wheel: true,
          startScale: 1.0,
          maxScale: 3,
          minScale: 0.3,
          scaleSpeed: 1.2,
          pinch: true
        },

      });

    Blockly.defineBlocksWithJsonArray([
      {
        "type": "onOpmodeStart",
        "message0": "on opmode start",
        "tooltip": "Code attached to this block will run on start",
        "nextStatement": null,
        "colour": "#4287f5",
      },
      {
        "type": "pause",
        "message0": "Wait for %1 milliseconds",
        "tooltip": "Waits for a time in milliseconds",
        "colour": "30",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_number",
            "name": "delayTime",
            "value": 1000,
            "min": 100,
            "max": 10000
          }
        ]
      },
      // Define the parameters for how the physical blocks will look and function in the program


      {
        "type": "gamepadInputs",
        "message0": "%1 . %2",
        "tooltip": "Provides inputs from the gamepads",
        "colour": "1",
        "output": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "gamepadSelection",
            "options": [
              ["gamepad1", "gamepad1"],
              ["gamepad2", "gamepad2"]
            ]
          },
          {
            "type": "field_dropdown",
            "name": "controller_component",
            "options": [
              ["A", "A"],
              ["AtRest", "atRest"],
              ["B", "B"],
              ["Back", "back"],
              ["Circle", "circle"],
              ["Cross", "Cross"],
              ["DpadDown", "dpadDown"],
              ["DpadLeft", "dpadLeft"],
              ["DpadRight", "dpadRight"],
              ["DpadUp", "dpadUp"],
              ["Guide", "guide"],
              ["LeftBumper", "leftBumper"],
              ["LeftStickButton", "leftStickButton"],
              ["Options", "options"],
              ["PS", "PS"],
              ["RightBumper", "rightBumper"],
              ["RightStickButton", "rightStickButton"],
              ["Share", "share"],
              ["Square", "square"],
              ["Start", "start"],
              ["Touchpad", "touchpad"],
              ["Triangle", "triangle"],
              ["X", "X"],
              ["Y", "Y"]
            ]
          }
        ]
      },
      // Experimental block for incorporating both the set power and set target position blocks in one block
      {
        "type": "setMotorInput",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Power", "power"],
              ["MaxSpeed", "maxSpeed"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "velocity"]
            ]
          },
          {
            "type": "input_value",
            "name": "power"
          }
        ]

      },

      {
        "type": "setMotorInputDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor inputs for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Power", "power"],
              ["MaxSpeed", "maxSpeed"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "velocity"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "power1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "power2",
            "align": "RIGHT"
          }
        ]

      },


      {
        "type": "getMotorData",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["CurrentPosition", "currentPosition"],
              ["MaxSpeed", "maxSpeed"],
              ["Power", "Power"],
              ["TargetPosition", "targetPosition"],
              ["TargetPositionTolerance", "targetPositionTolerance"],
              ["Velocity", "Velocity"]
            ]
          }
        ]

      },

      // Get the direction of the selected motor
      {
        "type": "getMotorDirection",
        "message0": "%1 . %2",
        "tooltip": "Get the direction of the selected motor",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Direction", "direction"]
            ]
          }
        ]

      },

      {
        "type": "isMotorBusy",
        "message0": "call %1 . %2",
        "tooltip": "Checks to see if the selected motor is rnning",
        "colour": "#985ba5",
        "output": "boolean",
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "motorOption",
            "text": "isBusy"
          }
        ]

      },

      {
        "type": "setMotorEnable",
        "message0": "call %1 . %2",
        "tooltip": "Enables the motor called",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "enableMotor",
            "text": "setMotorEnable"
          }
        ]

      },

      {
        "type": "setMotorDisable",
        "message0": "call %1 . %2",
        "tooltip": "Disables the motor called",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "enableMotor",
            "text": "setMotorDisable"
          }
        ]

      },


      // Set the run mode for the motors
      {
        "type": "setMotorRunMode",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the run mode of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Mode", "mode"]
            ]
          },
          {
            "type": "input_value",
            "name": "runMode",
          }
        ]

      },

      {
        "type": "setMotorRunModeDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor run mode for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Mode", "mode"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },



      {
        "type": "runModeOptions",
        "message0": "%1 . %2",
        "tooltip": "Creates the shadow block for the run mode of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "RunMode"
          },
          {
            "type": "field_dropdown",
            "name": "runMode",
            "options": [
              ["RUN_WITHOUT_ENCODER", "RUN_WITHOUT_ENCODER"],
              ["RUN_USING_ENCODER", "RUN_USING_ENCODER"],
              ["RUN_TO_POSITION", "RUN_TO_POSITION"],
              ["STOP_AND_RESET_ENCODER", "STOP_AND_RESET_ENCODER"]
            ]
          }
        ]

      },

      // Sets the Zero Power Behavior of the selected motor
      {
        "type": "setMotorZeroPowerBehavior",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the zero power behavior of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["ZeroPowerBehavior", "zeroPowerBehavior"]
            ]
          },
          {
            "type": "input_value",
            "name": "motorOption2",
          }
        ]

      },

      {
        "type": "setMotorZeroPowerBehaviorDual",
        "message0": "set %1 %2 %3 to %4 %5 to %6",
        "tooltip": "Set the motor zero power behavior for two motors at once",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["ZeroPowerBehavior", "mode"]
            ]
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "field_dropdown",
            "name": "motorName2",
            "options": [
              ["frontRight", "frontRight"],
              ["frontLeft", "frontLeft"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },

      {
        "type": "zeroPowerBehaviorOptions",
        "message0": "%1 . %2",
        "tooltip": "Shadow block for the set zero power behavior block",
        "colour": "#f58a42",
        "output": "Number",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "ZeroPowerBehavior"
          },
          {
            "type": "field_dropdown",
            "name": "runMode",
            "options": [
              ["BRAKE", "brake"],
              ["FLOAT", "float"]
            ]
          }
        ]

      },

      {
        "type": "setMotorVelocity",
        "message0": "call %1 . %2 %3 angularRate %4 angleUnit %5",
        "tooltip": "Set the motor inputs for two motors at once",
        "colour": "#985ba5",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName1",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_input",
            "name": "setVelocity",
            "text": "setVelocity"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "input1",
            "align": "RIGHT"
          },
          {
            "type": "input_value",
            "name": "input2",
            "align": "RIGHT"
          }
        ]

      },

      {
        "type": "setVelocityAngleUnitInput",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "AngleUnity"
          },
          {
            "type": "field_dropdown",
            "name": "degrees",
            "options": [
              ["DEGREES", "degrees"]
            ]
          }
        ]

      },


      {
        "type": "directionInput",
        "message0": "%1 . %2",
        "tooltip": "Sets the targetPosition or Power of a given motor",
        "colour": "#f58a42",
        "output": "string",
        "args0": [
          {
            "type": "field_input",
            "name": "text1",
            "text": "Direction"
          },
          {
            "type": "field_dropdown",
            "name": "direction",
            "options": [
              ["REVERSE", "reverse"],
              ["FORWARD", "forward"]
            ]
          }
        ]

      },

      // This next section defines the layout of the set direction block
      {
        "type": "setMotorDirection",
        "message0": "set %1 . %2 to %3",
        "tooltip": "Sets the direction of a given motor",
        "colour": "#f58a42",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_dropdown",
            "name": "motorName",
            "options": [
              ["frontLeft", "frontLeft"],
              ["frontRight", "frontRight"],
              ["backLeft", "backLeft"],
              ["backRight", "backRight"],
              ["ringCollection", "ringCollection"],
              ["ringLoader", "ringLoader"],
              ["ringShooter", "ringShooter"],
              ["wobbleActuator", "wobbleActuator"],
            ]
          },
          {
            "type": "field_dropdown",
            "name": "motorOption",
            "options": [
              ["Direction", "direction"]
            ]
          },
          {
            "type": "input_value",
            "name": "motorOption2",
          }

        ]
      },

      /**
       * end of shadow block test section
       * 
       */

      {
        "type": "telemetryUpdate",
        "message0": "call %1 . %2",
        "tooltip": "Update all active telemetry",
        "colour": "250",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_input",
            "name": "Telemetry",
            "text": "Telemetry"
          },
          {
            "type": "field_input",
            "name": "update",
            "text": "update"
          }
        ]
      },

      {
        "type": "comment",
        "message0": "%1",
        "args0": [
          {
            "type": "field_input",
            "name": "commentText",
            "text": "Enter your comment here!"
          }
        ],
        "tooltip": "Update all active telemetry",
        "colour": "230",
        "nextStatement": null,
        "previousStatement": null,
      },


      {
        "type": "telemetryAddData",
        "message0": "call %1 . %2 %3 key %4 %5 data %6",
        "tooltip": "Add Data to active telemetry",
        "colour": "250",
        "nextStatement": null,
        "previousStatement": null,
        "args0": [
          {
            "type": "field_input",
            "name": "Telemetry",
            "text": "Telemetry"
          },
          {
            "type": "field_input",
            "name": "addData",
            "text": "addData"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "key",
            "align": "RIGHT"
          },
          {
            "type": "input_dummy"
          },
          {
            "type": "input_value",
            "name": "data",
            "align": "RIGHT"
          }
        ]
      },

    ]);

    Blockly.Xml.domToWorkspace(Blockly.Xml.textToDom('<xml><block type="onOpmodeStart" deletable="false" movable="true"></block></xml>'), workspace);
  </script>
</body>

</html>